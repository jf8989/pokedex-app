let pokemonRepository=function(){let i=[],r=1,d=10,o="pokemonListCache",t="PokemonRepository",l=(e,...o)=>{var n=(new Date).toISOString();console[e](`[${n}] [${t}]`,...o)};function n(){l("info","renderList called for page "+r);var e,o,n,t,a=document.querySelector("#pokemon-grid");a?(a.innerHTML="",a=f(),l("info",`Rendering ${a.length} items for page `+r),a.forEach(o=>{var t=o,o=document.querySelector("#pokemon-grid");if(o){var n=document.createElement("div");n.classList.add("col-12","col-sm-6","col-md-4","col-lg-2","mb-4","pokemon-grid-col");let e=document.createElement("div");e.classList.add("card","pokemon-card","h-100");var a=document.createElement("div"),i=(a.classList.add("card-body","d-flex","flex-column","justify-content-center","align-items-center"),document.createElement("h5"));i.classList.add("card-title","text-center"),i.innerText=m(t.name),a.appendChild(i),e.appendChild(a),e.addEventListener("click",()=>{var n;l("info","Card clicked for: "+t.name),n=t,l("info","showDetails called for: "+n.name),c(`Loading ${m(n.name)}...`),s(n).then(()=>{l("info","Showing modal for: "+n.name),g();var e=n;if(l("info","showModal called for: "+e.name),"undefined"!=typeof $&&$.fn.modal){var o,t=document.querySelector("#pokemonModalLabel"),a=document.querySelector("#pokemonName"),i=document.querySelector("#pokemonHeight"),r=document.querySelector("#pokemonImage");let n=document.querySelector("#pokemonTypes");t&&a&&i&&r&&n?(o=m(e.name),t.innerText=o,a.innerText=o,i.innerText="Height: "+(e.height?e.height/10+" m":"N/A"),r.src=e.imageUrl||"images/pokeball-placeholder.png",r.alt=e.imageUrl?"Image of "+o:"Image not available",n.innerHTML="",e.types&&0<e.types.length?(n.innerText="Types: ",e.types.forEach(e=>{var o=document.createElement("span");o.classList.add("pokemon-type","type-"+e),o.innerText=e,n.appendChild(o)})):n.innerText="Types: N/A",$("#pokemonModal").modal("show"),$("#pokemonModal").off("shown.bs.modal").on("shown.bs.modal",function(){l("info","Modal shown for "+e.name)}),$("#pokemonModal").off("hidden.bs.modal").on("hidden.bs.modal",function(){l("info","Modal hidden for "+e.name)})):l("error","One or more modal elements not found.")}else l("error","Bootstrap modal plugin ($ or $.fn.modal) is not available"),p("Cannot display Pokémon details. Modal component is missing.")}).catch(e=>{l("error","Cannot show details because loading failed for "+n.name,e),g(),p(`Could not load details for ${m(n.name)}.`)})}),e.addEventListener("mouseenter",()=>e.classList.add("hover")),e.addEventListener("mouseleave",()=>e.classList.remove("hover")),n.appendChild(e),o.appendChild(n)}else l("error","Pokemon grid row element not found in addListItem")}),a=i.length,e=document.getElementById("pagination-controls"),0!==a&&e?(o=Math.ceil(a/d),l("info",`Updating pagination: Page ${r}/${o} (Total items: ${a})`),a=document.getElementById("prev-page"),n=document.getElementById("next-page"),t=document.getElementById("page-counter"),a?a.disabled=1===r:l("warn","Previous page button not found"),n?n.disabled=r===o:l("warn","Next page button not found"),t?t.innerText=`Page ${r} of `+o:l("warn","Page counter element not found"),e.style.display="flex"):(l("info","No Pokémon data or pagination container found, hiding controls."),e&&(e.style.display="none"))):l("error","Pokemon grid element (#pokemon-grid) not found")}function a(){var e=f();l("info",`Preloading details for ${e.length} Pokémon on page `+r),e.forEach(o=>{void 0===o.height&&s(o).catch(e=>{l("warn","Background detail preload failed for "+o.name,e)})})}function s(o){if(void 0!==o.height&&void 0!==o.types&&void 0!==o.imageUrl)return l("info","Details already loaded for "+o.name),Promise.resolve();l("info","loadDetails called for: "+o.name);let n=o.detailsUrl;return fetch(n).then(e=>{if(e.ok)return e.json();throw new Error(`HTTP error! status: ${e.status} for `+n)}).then(e=>{l("info","Details received for: "+o.name),o.height=e.height,o.types=e.types.map(e=>e.type.name),o.imageUrl=e.sprites.front_default}).catch(e=>(l("error","Failed to load details for "+o.name,e),Promise.reject(e)))}function m(e){return"string"!=typeof e||0===e.length?"":e.charAt(0).toUpperCase()+e.slice(1)}function c(e="Loading..."){l("info",`Showing loading message: "${e}"`);let o=document.getElementById("loading-message");var n,t,a;o?((n=document.getElementById("loading-message-text"))&&(n.innerText=e),o.style.display="flex"):((o=document.createElement("div")).id="loading-message",o.className="loading-indicator",(n=document.createElement("div")).className="loading-box",(t=document.createElement("div")).className="spinner",(a=document.createElement("p")).id="loading-message-text",a.className="loading-text",a.innerText=e,n.appendChild(t),n.appendChild(a),o.appendChild(n),document.body.appendChild(o))}function g(){l("info","Hiding loading message");var e=document.getElementById("loading-message");e&&(e.style.display="none")}function p(e){l("warn",`Displaying error to user: "${e}"`),alert("Error: "+e)}function f(){var e=(r-1)*d,o=e+d;return l("info",`Getting items for page ${r}, startIndex: ${e}, endIndex: `+o),i.slice(e,o)}function u(){var e=Math.ceil(i.length/d);r<e?(l("info",`Navigating to next page (Page ${r+1})`),r++,n(),a(),window.scrollTo(0,0)):l("info","Already on the last page, cannot go next.")}function h(){1<r?(l("info",`Navigating to previous page (Page ${r-1})`),r--,n(),a(),window.scrollTo(0,0)):l("info","Already on the first page, cannot go previous.")}return l("info","Repository initialized"),{loadList:function(){l("info","loadList called"),c("Loading Pokémon list...");try{var e=sessionStorage.getItem(o);if(e)return l("info","Found cached Pokémon list in sessionStorage."),i=JSON.parse(e),n(),g(),a(),Promise.resolve()}catch(e){l("error","Failed to read or parse cache",e),sessionStorage.removeItem(o)}l("info","No cache found or cache invalid. Fetching from API...");let t=[];return function o(n){return l("info","Fetching Pokémon page: "+n),fetch(n).then(e=>{if(e.ok)return e.json();throw new Error("HTTP error! status: "+e.status)}).then(e=>(l("info",`Received ${e.results.length} Pokémon from `+n),e.results.forEach(e=>{t.push({name:e.name,detailsUrl:e.url,height:void 0,types:void 0,imageUrl:void 0})}),e.next&&t.length<1e3?o(e.next):(l("info","Finished fetching all Pokémon pages."),null)))}("https://pokeapi.co/api/v2/pokemon?limit=151").then(()=>{l("info","Total Pokémon fetched: "+t.length),i=t;try{l("info","Caching complete Pokémon list to sessionStorage."),sessionStorage.setItem(o,JSON.stringify(i))}catch(e){l("error","Failed to cache Pokémon list",e)}n(),g(),a()}).catch(e=>{l("error","Failed to load Pokémon list from API",e),g(),p("Could not load Pokémon data. Please try refreshing the page.")})},initializePaginationListeners:function(){l("info","Initializing pagination listeners");var e=document.getElementById("next-page"),o=document.getElementById("prev-page");e?e.addEventListener("click",u):l("error","Next page button not found during listener initialization."),o?o.addEventListener("click",h):l("error","Previous page button not found during listener initialization.")}}}();document.addEventListener("DOMContentLoaded",function(){console.log("[DOMContentLoaded] DOM fully loaded and parsed.");var e,o=document.querySelector("#pokemon-container");o&&!document.querySelector("#pokemon-grid")?(console.log("[Initial Setup] Creating Pokémon grid row element."),(e=document.createElement("div")).className="row",e.id="pokemon-grid",o.appendChild(e)):o||console.error("[Initial Setup] Pokémon container element (#pokemon-container) not found."),pokemonRepository.initializePaginationListeners(),pokemonRepository.loadList().then(()=>{console.log("[DOMContentLoaded] Initial Pokémon list loaded and rendered.")}).catch(e=>{console.error("[DOMContentLoaded] Error during initial loadList:",e)})});